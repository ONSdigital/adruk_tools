
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Welcome to adruk_tools’s documentation! &#8212; adruk_tools  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/haiku.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="adruk_tools package" href="adruk_tools.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="#">
          <span>adruk_tools  documentation</span></a></h1>
        <h2 class="heading"><span>Welcome to adruk_tools’s documentation!</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        <a class="uplink" href="#">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="adruk_tools.html">adruk_tools package</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="module-adruk_tools.adr_functions">
<span id="welcome-to-adruk-tools-s-documentation"></span><h1>Welcome to adruk_tools’s documentation!<a class="headerlink" href="#module-adruk_tools.adr_functions" title="Permalink to this headline">¶</a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="adruk_tools.adr_functions.complex_harmonisation">
<span class="sig-prename descclassname"><span class="pre">adruk_tools.adr_functions.</span></span><span class="sig-name descname"><span class="pre">complex_harmonisation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/adruk_tools/adr_functions.html#complex_harmonisation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#adruk_tools.adr_functions.complex_harmonisation" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">WHAT IT IS</dt>
<dd class="field-odd"><p>function</p>
</dd>
<dt class="field-even">WHAT IT DOES</dt>
<dd class="field-even"><p></p></dd>
</dl>
<ul class="simple">
<li><p>where harmonisation leads to duplicate named variables within a dataset, this function harmonised to a single variable</p></li>
<li><p>a multiple record (_mr) flag is generated as an additional column to indicate if there is discrepancy in values for harmonised variables</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">USE</dt>
<dd class="field-odd"><p>used in 05c_aggregate_hive_tables.py</p>
</dd>
<dt class="field-even">AUTHOR</dt>
<dd class="field-even"><p>David Cobbledick</p>
</dd>
<dt class="field-odd">DATE</dt>
<dd class="field-odd"><p>08/01/2021</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="adruk_tools.adr_functions.complex_standardisation">
<span class="sig-prename descclassname"><span class="pre">adruk_tools.adr_functions.</span></span><span class="sig-name descname"><span class="pre">complex_standardisation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gender</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/adruk_tools/adr_functions.html#complex_standardisation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#adruk_tools.adr_functions.complex_standardisation" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">WHAT IT IS</dt>
<dd class="field-odd"><p>pyspark function</p>
</dd>
<dt class="field-even">WHAT IT DOES</dt>
<dd class="field-even"><p></p></dd>
</dl>
<ul class="simple">
<li><p>Enables more detailed secondary engineering of columns secified within the function</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">USE</dt>
<dd class="field-odd"><p>used in 05c_aggregate_hive_tables.py</p>
</dd>
<dt class="field-even">NOTES</dt>
<dd class="field-even"><p></p></dd>
</dl>
<ul class="simple">
<li><p>This can be adapted to suit data and processing requirements</p></li>
<li><p>The examples below show application for standardising sex, name and postcode variables</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">AUTHOR</dt>
<dd class="field-odd"><p>David Cobbledick</p>
</dd>
<dt class="field-even">DATE</dt>
<dd class="field-even"><p>08/01/2021</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="adruk_tools.adr_functions.cull_columns">
<span class="sig-prename descclassname"><span class="pre">adruk_tools.adr_functions.</span></span><span class="sig-name descname"><span class="pre">cull_columns</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cluster</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">old_files</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reference_columns</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">directory_out</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/adruk_tools/adr_functions.html#cull_columns"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#adruk_tools.adr_functions.cull_columns" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">WHAT IT IS</dt>
<dd class="field-odd"><p>pyspark function</p>
</dd>
<dt class="field-even">WHAT IT DOES</dt>
<dd class="field-even"><p></p></dd>
</dl>
<ul class="simple">
<li><p>reads in one or more HDFS csv files in turn</p></li>
<li><p>removes any columns not listed in a reference</p></li>
<li><p>write table back out</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">AUTHOR</dt>
<dd class="field-odd"><p>Johannes Hechler</p>
</dd>
<dt class="field-even">DATE</dt>
<dd class="field-even"><p>04/10/2021</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="adruk_tools.adr_functions.equalise_file_and_folder_name">
<span class="sig-prename descclassname"><span class="pre">adruk_tools.adr_functions.</span></span><span class="sig-name descname"><span class="pre">equalise_file_and_folder_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/adruk_tools/adr_functions.html#equalise_file_and_folder_name"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#adruk_tools.adr_functions.equalise_file_and_folder_name" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">WHAT IT IS</dt>
<dd class="field-odd"><p>Python function</p>
</dd>
<dt class="field-even">WHAT IT DOES</dt>
<dd class="field-even"><p>renames a .csv file to what their folder is called</p>
</dd>
<dt class="field-odd">NOTES</dt>
<dd class="field-odd"><p>only works if the file is in only 1 partition</p>
</dd>
<dt class="field-even">AUTHOR</dt>
<dd class="field-even"><p>Johannes Hechler</p>
</dd>
<dt class="field-odd">DATE</dt>
<dd class="field-odd"><p>04/10/2021</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="adruk_tools.adr_functions.generate_ids">
<span class="sig-prename descclassname"><span class="pre">adruk_tools.adr_functions.</span></span><span class="sig-name descname"><span class="pre">generate_ids</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">id_cols</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">id_len</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/adruk_tools/adr_functions.html#generate_ids"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#adruk_tools.adr_functions.generate_ids" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">WHAT IT IS</dt>
<dd class="field-odd"><p>pyspark function</p>
</dd>
<dt class="field-even">WHAT ID DOES</dt>
<dd class="field-even"><p>recodes a given column to random numerical values</p>
</dd>
<dt class="field-odd">WHY IT DOES IT</dt>
<dd class="field-odd"><p>to anonymise ID variables in ADRUK projects</p>
</dd>
<dt class="field-even">RETURNS</dt>
<dd class="field-even"><p>dataframe with 1 new column called ‘adr_id’, holding the new ID</p>
</dd>
<dt class="field-odd">OUTPUT VARIABLE TYPE</dt>
<dd class="field-odd"><p>spark dataframe</p>
</dd>
<dt class="field-even">KNOWN ISSUES</dt>
<dd class="field-even"><p>input dataset must not have existing column called ‘adr_id’</p>
</dd>
<dt class="field-odd">AUTHOR</dt>
<dd class="field-odd"><p>David Cobbledick</p>
</dd>
<dt class="field-even">DATE</dt>
<dd class="field-even"><p>2020</p>
</dd>
<dt class="field-odd">VERSION</dt>
<dd class="field-odd"><p>0.0.1</p>
</dd>
<dt class="field-even">PARAMETERS</dt>
<dd class="field-even"><ul class="simple">
<li><p>session = name of current spark cluster
<cite>(datatype = cluster name, no string)</cite>, e.g. spark</p></li>
<li><p>df = spark dataframe
<cite>(datatype = dataframe name, no string)</cite>, e.g. PDS</p></li>
<li><p>id_cols = column(s) to use for new ID
<cite>(datatype = list of strings)</cite>, e.g. [‘year’, ‘name’]</p></li>
<li><p>start_year = name of additional column(s) to use in ID
<cite>(datatype = list of strings)</cite>, e.g. [‘year’, ‘name’]</p></li>
<li><p>id_len = set uniform length of ID values if required. Pads out values with leading zeroes if needed. Default value = None, i.e. accept different lengths
<cite>(datatype = numeric)</cite>, e.g. 9</p></li>
</ul>
</dd>
<dt class="field-odd">EXAMPLE</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">generate_ids</span><span class="p">(</span><span class="n">sessions</span> <span class="o">=</span> <span class="n">spark</span><span class="p">,</span> 
<span class="go">                  df = AEDE, </span>
<span class="go">                  id_cols = [&#39;name&#39;, &#39;ID&#39;],</span>
<span class="go">                  start_year = [&#39;year&#39;], </span>
<span class="go">                  id_len = 9)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="adruk_tools.adr_functions.hdfs_to_pandas">
<span class="sig-prename descclassname"><span class="pre">adruk_tools.adr_functions.</span></span><span class="sig-name descname"><span class="pre">hdfs_to_pandas</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/adruk_tools/adr_functions.html#hdfs_to_pandas"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#adruk_tools.adr_functions.hdfs_to_pandas" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">WHAT IT IS</dt>
<dd class="field-odd"><p>Python function</p>
</dd>
<dt class="field-even">WHAT IT DOES</dt>
<dd class="field-even"><p>reads in small csv dataset from HDFS without the need for a spark cluster</p>
</dd>
<dt class="field-odd">RETURNS</dt>
<dd class="field-odd"><p>dataframe</p>
</dd>
<dt class="field-even">OUTPUT VARIABLE TYPE</dt>
<dd class="field-even"><p>pandas</p>
</dd>
<dt class="field-odd">AUTHOR</dt>
<dd class="field-odd"><p>Johannes Hechler</p>
</dd>
<dt class="field-even">DATE</dt>
<dd class="field-even"><p>19/11/2021</p>
</dd>
<dt class="field-odd">VERSION</dt>
<dd class="field-odd"><p>0.0.1</p>
</dd>
<dt class="field-even">KNOWN ISSUES</dt>
<dd class="field-even"><p>only works on .csv files</p>
</dd>
<dt class="field-odd">PARAMETERS</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<ul class="simple">
<li><dl class="simple">
<dt>file_path = full path to file to import</dt><dd><p><cite>(datatype = string)</cite>, e.g. ‘/dapsen/workspace_zone/my_project/sample.csv’</p>
</dd>
</dl>
</li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">EXAMPLE</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pydoop_read</span><span class="p">(</span><span class="n">file_path</span> <span class="o">=</span> <span class="s1">&#39;/dapsen/workspace_zone/my_project/sample.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="adruk_tools.adr_functions.make_test_df">
<span class="sig-prename descclassname"><span class="pre">adruk_tools.adr_functions.</span></span><span class="sig-name descname"><span class="pre">make_test_df</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session_name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/adruk_tools/adr_functions.html#make_test_df"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#adruk_tools.adr_functions.make_test_df" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">WHAT IT IS</dt>
<dd class="field-odd"><p>Function</p>
</dd>
<dt class="field-even">WHAT IT DOES</dt>
<dd class="field-even"><p>creates a dataframe with several columns of different data types for testing purposes. Intentionally includes various errors, e.g. typos.</p>
</dd>
<dt class="field-odd">RETURNS</dt>
<dd class="field-odd"><p>spark dataframe</p>
</dd>
<dt class="field-even">AUTHOR</dt>
<dd class="field-even"><p>Johannes Hechler</p>
</dd>
<dt class="field-odd">DATE</dt>
<dd class="field-odd"><p>27/08/2019</p>
</dd>
<dt class="field-even">VERSION</dt>
<dd class="field-even"><p>0.1</p>
</dd>
<dt class="field-odd">PARAMETERS</dt>
<dd class="field-odd"><ul class="simple">
<li><p>session_name = name of the spark session to use
<cite>(datatype = session name, unquoted)</cite>, e.g. spark</p></li>
</ul>
</dd>
<dt class="field-even">EXAMPLE</dt>
<dd class="field-even"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">make_test_df</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="adruk_tools.adr_functions.manifest">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">adruk_tools.adr_functions.</span></span><span class="sig-name descname"><span class="pre">manifest</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/adruk_tools/adr_functions.html#manifest"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#adruk_tools.adr_functions.manifest" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">WHAT IT IS</dt>
<dd class="field-odd"><p>Python class</p>
</dd>
<dt class="field-even">WHAT IT DOES</dt>
<dd class="field-even"><p></p></dd>
</dl>
<ul class="simple">
<li><p>creates an object of class ‘manifest’</p></li>
<li><p>assign several methods to the object</p></li>
<li><p>designed extract data from nested dictionaries, in particular .mani files on HDFS</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">AUTHOR</dt>
<dd class="field-odd"><p>Johannes Hechler</p>
</dd>
<dt class="field-even">DATE</dt>
<dd class="field-even"><p>09/02/2021</p>
</dd>
<dt class="field-odd">VERSION</dt>
<dd class="field-odd"><p>0.1</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="adruk_tools.adr_functions.manifest.parts">
<span class="sig-name descname"><span class="pre">parts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">variable</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/adruk_tools/adr_functions.html#manifest.parts"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#adruk_tools.adr_functions.manifest.parts" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">WHAT IT IS</dt>
<dd class="field-odd"><p>Python method for objects of class ‘manifest’</p>
</dd>
<dt class="field-even">WHAT IT DOES</dt>
<dd class="field-even"><p></p></dd>
</dl>
<ul class="simple">
<li><p>generates property ‘parts’, i.e. information about the individual files included in a delivery, as a pandas dataframe with as many rows as there are files</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">AUTHOR</dt>
<dd class="field-odd"><p>Johannes Hechler</p>
</dd>
<dt class="field-even">DATE</dt>
<dd class="field-even"><p>09/02/2021</p>
</dd>
<dt class="field-odd">VERSION</dt>
<dd class="field-odd"><p>0.1</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="adruk_tools.adr_functions.manifest.whole">
<span class="sig-name descname"><span class="pre">whole</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/adruk_tools/adr_functions.html#manifest.whole"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#adruk_tools.adr_functions.manifest.whole" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">WHAT IT IS</dt>
<dd class="field-odd"><p>Python method for objects of class ‘manifest’</p>
</dd>
<dt class="field-even">WHAT IT DOES</dt>
<dd class="field-even"><p></p></dd>
</dl>
<ul class="simple">
<li><p>generates property ‘whole’, i.e. information about the overall delivery, as a pandas dataframe with 1 row</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">AUTHOR</dt>
<dd class="field-odd"><p>Johannes Hechler</p>
</dd>
<dt class="field-even">DATE</dt>
<dd class="field-even"><p>09/02/2021</p>
</dd>
<dt class="field-odd">VERSION</dt>
<dd class="field-odd"><p>0.1</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="adruk_tools.adr_functions.pandas_to_hdfs">
<span class="sig-prename descclassname"><span class="pre">adruk_tools.adr_functions.</span></span><span class="sig-name descname"><span class="pre">pandas_to_hdfs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataframe</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">write_path</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/adruk_tools/adr_functions.html#pandas_to_hdfs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#adruk_tools.adr_functions.pandas_to_hdfs" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">WHAT IT IS</dt>
<dd class="field-odd"><p>Python function</p>
</dd>
<dt class="field-even">WHAT IT DOES</dt>
<dd class="field-even"><p>write a pandas dataframe to HDFS as .csv without the need for a spark cluster</p>
</dd>
<dt class="field-odd">RETURNS</dt>
<dd class="field-odd"><p>N/A</p>
</dd>
<dt class="field-even">OUTPUT VARIABLE TYPE</dt>
<dd class="field-even"><p>N/A</p>
</dd>
<dt class="field-odd">AUTHOR</dt>
<dd class="field-odd"><p>Johannes Hechler</p>
</dd>
<dt class="field-even">DATE</dt>
<dd class="field-even"><p>09/11/2021</p>
</dd>
<dt class="field-odd">VERSION</dt>
<dd class="field-odd"><p>0.0.1</p>
</dd>
<dt class="field-even">KNOWN ISSUES</dt>
<dd class="field-even"><p>None</p>
</dd>
<dt class="field-odd">PARAMETERS</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<ul class="simple">
<li><dl class="simple">
<dt>dataframe = pandas dataframe you want to write to HDFS</dt><dd><p><cite>(datatype = dataframe, no string)</cite>, e.g. my_data</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>file_path = full destination file path including extension</dt><dd><p><cite>(datatype = string)</cite>, e.g. ‘/dapsen/workspace_zone/my_project/sample.csv’</p>
</dd>
</dl>
</li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">EXAMPLE</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pandas_to_hdfs</span><span class="p">(</span> <span class="n">dataframe</span> <span class="o">=</span> <span class="n">my_data</span><span class="p">,</span> 
<span class="go">                    file_path = &#39;/dapsen/workspace_zone/my_project/sample.csv&#39;)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="adruk_tools.adr_functions.pydoop_read">
<span class="sig-prename descclassname"><span class="pre">adruk_tools.adr_functions.</span></span><span class="sig-name descname"><span class="pre">pydoop_read</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/adruk_tools/adr_functions.html#pydoop_read"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#adruk_tools.adr_functions.pydoop_read" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">WHAT IT IS</dt>
<dd class="field-odd"><p>Python function</p>
</dd>
<dt class="field-even">WHAT IT DOES</dt>
<dd class="field-even"><p>reads in small dataset from HDFS without the need for a spark cluster</p>
</dd>
<dt class="field-odd">RETURNS</dt>
<dd class="field-odd"><p>un-parsed, unformatted dataset</p>
</dd>
<dt class="field-even">OUTPUT VARIABLE TYPE</dt>
<dd class="field-even"><p>bytes</p>
</dd>
<dt class="field-odd">AUTHOR</dt>
<dd class="field-odd"><p>Johannes Hechler</p>
</dd>
<dt class="field-even">DATE</dt>
<dd class="field-even"><p>28/09/2021</p>
</dd>
<dt class="field-odd">VERSION</dt>
<dd class="field-odd"><p>0.0.1</p>
</dd>
<dt class="field-even">KNOWN ISSUES</dt>
<dd class="field-even"><p>not all parsing functions accept this output. pd.read_excel() does, pd.read_csv() does not</p>
</dd>
<dt class="field-odd">PARAMETERS</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<ul class="simple">
<li><dl class="simple">
<dt>file_path = full path to file to import</dt><dd><p><cite>(datatype = string)</cite>, e.g. ‘/dapsen/workspace_zone/my_project/sample.csv’</p>
</dd>
</dl>
</li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">EXAMPLE</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pydoop_read</span><span class="p">(</span><span class="n">file_path</span> <span class="o">=</span> <span class="s1">&#39;/dapsen/workspace_zone/my_project/sample.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="adruk_tools.adr_functions.save_sample">
<span class="sig-prename descclassname"><span class="pre">adruk_tools.adr_functions.</span></span><span class="sig-name descname"><span class="pre">save_sample</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataframe</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">na_variables</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/adruk_tools/adr_functions.html#save_sample"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#adruk_tools.adr_functions.save_sample" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">WHAT IT IS</dt>
<dd class="field-odd"><p>PYSPARK FUNCTION</p>
</dd>
<dt class="field-even">WHAT IT DOES</dt>
<dd class="field-even"><p>draws as user-specified number of records from the top of a dataset and saves them to a selected location in csv format</p>
</dd>
<dt class="field-odd">RETURNS</dt>
<dd class="field-odd"><p>nothing in memory; writes out a comma-separated file</p>
</dd>
<dt class="field-even">OUTPUT VARIABLE TYPE</dt>
<dd class="field-even"><p>not applicable</p>
</dd>
<dt class="field-odd">TESTED TO RUN ON</dt>
<dd class="field-odd"><p>spark dataframe from covid test and trace dataset</p>
</dd>
<dt class="field-even">AUTHOR</dt>
<dd class="field-even"><p>Ben Marshall-Sheen, Johannes Hechler</p>
</dd>
<dt class="field-odd">DATE</dt>
<dd class="field-odd"><p>17/12/2020</p>
</dd>
<dt class="field-even">VERSION</dt>
<dd class="field-even"><p>0.0.1</p>
</dd>
<dt class="field-odd">KNOWN ISSUES</dt>
<dd class="field-odd"><p>None</p>
</dd>
<dt class="field-even">PARAMETERS</dt>
<dd class="field-even"><p></p></dd>
</dl>
<ul>
<li><dl class="simple">
<dt>dataframe = spark dataframe</dt><dd><p><cite>(datatype = dataframe name, no string)</cite>, e.g. ctas_data</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>sample_size = how many rows to take from dataset. Default values = 20.</dt><dd><p><cite>(datatype = numeric)</cite>, e.g. 20</p>
</dd>
</dl>
</li>
<li><dl>
<dt>filepath = the directory and filename for the file to be written to.</dt><dd><dl class="simple">
<dt><cite>(datatype = string)</cite>, e.g. “/dapsen/workspace_zone/adruk/sample.csv”</dt><dd><ul class="simple">
<li><p>na_variables = if you want to exclude records with missing data from the sample, you can specify the names of columns to check for missingness. Records are removed if ANY of the selected variables is missing. Optional. Default value = []</p></li>
</ul>
</dd>
</dl>
<p><cite>(datatype = list of strings)</cite>, e.g. [‘age’, ‘sex]</p>
</dd>
</dl>
</li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">EXAMPLE</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">save_sample</span><span class="p">(</span> <span class="n">dataframe</span> <span class="o">=</span> <span class="n">pii_data</span><span class="p">,</span> 
<span class="go">                 sample_size = 20, </span>
<span class="go">                 filepath = &#39;/dapsen/workspace_zone/my_project/sample.csv)))</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="adruk_tools.adr_functions.session_large">
<span class="sig-prename descclassname"><span class="pre">adruk_tools.adr_functions.</span></span><span class="sig-name descname"><span class="pre">session_large</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/adruk_tools/adr_functions.html#session_large"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#adruk_tools.adr_functions.session_large" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">WHAT IT IS</dt>
<dd class="field-odd"><p>pyspark function</p>
</dd>
<dt class="field-even">WHAT IT DOES</dt>
<dd class="field-even"><p>creates spark cluster with these parameters. Designed for running Production pipelines on large administrative data, rather than just survey data. Will often develop using a smaller session then change to this once the pipeline is complete.
* 10g of memory
* 5 executors
* 1g of memory overhead
* 5 cores, which is generally optimal on larger sessions
* Number of partitions are limited to 18, which can improve performance with smaller data</p>
</dd>
<dt class="field-odd">RETURNS</dt>
<dd class="field-odd"><p>spark cluster</p>
</dd>
<dt class="field-even">OUTPUT VARIABLE TYPE</dt>
<dd class="field-even"><p>spark cluster</p>
</dd>
<dt class="field-odd">NOTES</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<ul class="simple">
<li><p>for production pipelines on administrative data</p></li>
<li><p>Cannot be used in Dev Test, as 9 GB limit per executor</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">AUTHOR</dt>
<dd class="field-odd"><p>DAPCATS</p>
</dd>
<dt class="field-even">DATE</dt>
<dd class="field-even"><p>2021</p>
</dd>
<dt class="field-odd">VERSION</dt>
<dd class="field-odd"><p>0.0.1</p>
</dd>
<dt class="field-even">KNOWN ISSUES</dt>
<dd class="field-even"><p>None</p>
</dd>
<dt class="field-odd">EXAMPLE</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session_large</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="adruk_tools.adr_functions.session_medium">
<span class="sig-prename descclassname"><span class="pre">adruk_tools.adr_functions.</span></span><span class="sig-name descname"><span class="pre">session_medium</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/adruk_tools/adr_functions.html#session_medium"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#adruk_tools.adr_functions.session_medium" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">WHAT IT IS</dt>
<dd class="field-odd"><p>pyspark function</p>
</dd>
<dt class="field-even">WHAT IT DOES</dt>
<dd class="field-even"><p>creates spark cluster with these parameters. Designed for analysing survey or synthetic datasets. Also used for some Production pipelines based on survey and/or smaller administrative data.
* 6g of memory
* 3 executors
* 3 cores
* Number of partitions are limited to 18, which can improve performance with smaller data</p>
</dd>
<dt class="field-odd">RETURNS</dt>
<dd class="field-odd"><p>spark cluster</p>
</dd>
<dt class="field-even">OUTPUT VARIABLE TYPE</dt>
<dd class="field-even"><p>spark cluster</p>
</dd>
<dt class="field-odd">USE CASE</dt>
<dd class="field-odd"><ul class="simple">
<li><p>Developing code in Dev Test</p></li>
<li><p>Data exploration in Production</p></li>
<li><p>Developing Production pipelines on a sample of data</p></li>
<li><p>Running smaller Production pipelines on mostly survey data</p></li>
</ul>
</dd>
<dt class="field-even">AUTHOR</dt>
<dd class="field-even"><p>DAPCATS</p>
</dd>
<dt class="field-odd">DATE</dt>
<dd class="field-odd"><p>2021</p>
</dd>
<dt class="field-even">VERSION</dt>
<dd class="field-even"><p>0.0.1</p>
</dd>
<dt class="field-odd">KNOWN ISSUES</dt>
<dd class="field-odd"><p>None</p>
</dd>
<dt class="field-even">EXAMPLE</dt>
<dd class="field-even"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session_medium</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="adruk_tools.adr_functions.session_small">
<span class="sig-prename descclassname"><span class="pre">adruk_tools.adr_functions.</span></span><span class="sig-name descname"><span class="pre">session_small</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/adruk_tools/adr_functions.html#session_small"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#adruk_tools.adr_functions.session_small" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">WHAT IT IS</dt>
<dd class="field-odd"><p>pyspark function</p>
</dd>
<dt class="field-even">WHAT IT DOES</dt>
<dd class="field-even"><p>creates spark cluster with these parameters. Designed for simple data exploration of small survey data.
* 1g of memory
* 3 executors
* 1 core
* Number of partitions are limited to 12, which can improve performance with smaller data</p>
</dd>
<dt class="field-odd">RETURNS</dt>
<dd class="field-odd"><p>spark cluster</p>
</dd>
<dt class="field-even">OUTPUT VARIABLE TYPE</dt>
<dd class="field-even"><p>spark cluster</p>
</dd>
<dt class="field-odd">NOTES</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<ul class="simple">
<li><p>This session is similar to that used for DAPCATS training</p></li>
<li><p>It is the smallest session that is realistically used</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">AUTHOR</dt>
<dd class="field-odd"><p>DAPCATS</p>
</dd>
<dt class="field-even">DATE</dt>
<dd class="field-even"><p>2021</p>
</dd>
<dt class="field-odd">VERSION</dt>
<dd class="field-odd"><p>0.0.1</p>
</dd>
<dt class="field-even">KNOWN ISSUES</dt>
<dd class="field-even"><p>None</p>
</dd>
<dt class="field-odd">EXAMPLE</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session_small</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="adruk_tools.adr_functions.session_xl">
<span class="sig-prename descclassname"><span class="pre">adruk_tools.adr_functions.</span></span><span class="sig-name descname"><span class="pre">session_xl</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/adruk_tools/adr_functions.html#session_xl"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#adruk_tools.adr_functions.session_xl" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">WHAT IT IS</dt>
<dd class="field-odd"><p>pyspark function</p>
</dd>
<dt class="field-even">WHAT IT DOES</dt>
<dd class="field-even"><p>creates spark cluster with these parameters. Designed for the most complex pipelines, with huge administrative data sources and complex calculations. Uses a large amount of resource on the cluster, so only use when running Production pipelines
* 20g of memory
* 12 executors
* 2g of memory overhead
* 5 cores, using too many cores can actually cause worse performance on larger sessions</p>
</dd>
<dt class="field-odd">RETURNS</dt>
<dd class="field-odd"><p>spark cluster</p>
</dd>
<dt class="field-even">OUTPUT VARIABLE TYPE</dt>
<dd class="field-even"><p>spark cluster</p>
</dd>
<dt class="field-odd">NOTES</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<ul class="simple">
<li><p>use for large, complex pipelines in Production on mostly administrative data</p></li>
<li><p>Do not use for development purposes; use a smaller session and work on a sample of data or synthetic data</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">EXAMPLE USE</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<ul class="simple">
<li><p>Three administrative datasets of around 300 million rows</p></li>
<li><p>Significant calculations, including joins and writing/reading to many intermediate tables</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">AUTHOR</dt>
<dd class="field-odd"><p>DAPCATS</p>
</dd>
<dt class="field-even">DATE</dt>
<dd class="field-even"><p>2021</p>
</dd>
<dt class="field-odd">VERSION</dt>
<dd class="field-odd"><p>0.0.1</p>
</dd>
<dt class="field-even">KNOWN ISSUES</dt>
<dd class="field-even"><p>None</p>
</dd>
<dt class="field-odd">EXAMPLE</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session_xl</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="adruk_tools.adr_functions.spark_glob">
<span class="sig-prename descclassname"><span class="pre">adruk_tools.adr_functions.</span></span><span class="sig-name descname"><span class="pre">spark_glob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">host</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">directory</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/adruk_tools/adr_functions.html#spark_glob"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#adruk_tools.adr_functions.spark_glob" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">WHAT IT IS</dt>
<dd class="field-odd"><p>pyspark function</p>
</dd>
<dt class="field-even">WHAT IT DOES</dt>
<dd class="field-even"><p>lists names of files or subdirectories in a given directory</p>
</dd>
<dt class="field-odd">RETURNS</dt>
<dd class="field-odd"><p>list of file / directory names</p>
</dd>
<dt class="field-even">OUTPUT VARIABLES TYPE</dt>
<dd class="field-even"><p>list of strings</p>
</dd>
<dt class="field-odd">NOTES</dt>
<dd class="field-odd"><p>expects an existing connection to a spark cluster</p>
</dd>
<dt class="field-even">AUTHOR</dt>
<dd class="field-even"><p>David Cobbledick</p>
</dd>
<dt class="field-odd">DATE</dt>
<dd class="field-odd"><p>2020</p>
</dd>
<dt class="field-even">VERSION</dt>
<dd class="field-even"><p>0.1</p>
</dd>
<dt class="field-odd">PARAMETERS</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<ul class="simple">
<li><dl class="field-list simple">
<dt class="field-odd">host = a valid CDSW user name. not necessarily that of the current users</dt>
<dd class="field-odd"><p><cite>(datatype = string)</cite>, e.g. ‘hechlj’</p>
</dd>
</dl>
</li>
<li><dl class="field-list simple">
<dt class="field-odd">directory = for name of the directory to check</dt>
<dd class="field-odd"><p><cite>(datatype = string)</cite>, e.g. ‘/dapsen/landing_zone/hmrc/self_assessment/2017/v1’</p>
</dd>
</dl>
</li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">EXAMPLE</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">spark_glob</span><span class="p">(</span><span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;hechlj&#39;</span><span class="p">,</span>
<span class="go">                directory = &#39;/dapsen/landing_zone/hmrc/self_assessment/2017/v1&#39;)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="adruk_tools.adr_functions.spark_glob_all">
<span class="sig-prename descclassname"><span class="pre">adruk_tools.adr_functions.</span></span><span class="sig-name descname"><span class="pre">spark_glob_all</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">host</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">directory</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/adruk_tools/adr_functions.html#spark_glob_all"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#adruk_tools.adr_functions.spark_glob_all" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">WHAT IT IS</dt>
<dd class="field-odd"><p>pyspark function</p>
</dd>
<dt class="field-even">WHAT IT DOES</dt>
<dd class="field-even"><p>lists names of files or subdirectories in a given directory, and all subdirectories</p>
</dd>
<dt class="field-odd">RETURNS</dt>
<dd class="field-odd"><p>list of file / directory names</p>
</dd>
<dt class="field-even">OUTPUT VARIABLES TYPE</dt>
<dd class="field-even"><p>list of strings</p>
</dd>
<dt class="field-odd">NOTES</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<ul class="simple">
<li><p>expects an existing connection to a spark cluster</p></li>
<li><p>expect the package <cite>adruk_tools</cite> including the function <cite>spark_glob</cite> to be installed</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">AUTHOR</dt>
<dd class="field-odd"><p>David Cobbledick</p>
</dd>
<dt class="field-even">DATE</dt>
<dd class="field-even"><p>2020</p>
</dd>
<dt class="field-odd">VERSION</dt>
<dd class="field-odd"><p>0.1</p>
</dd>
<dt class="field-even">PARAMETERS</dt>
<dd class="field-even"><p></p></dd>
</dl>
<ul class="simple">
<li><dl class="field-list simple">
<dt class="field-odd">host = a valid CDSW user name. not necessarily that of the current users</dt>
<dd class="field-odd"><p><cite>(datatype = string)</cite>, e.g. ‘hechlj’</p>
</dd>
</dl>
</li>
<li><dl class="field-list simple">
<dt class="field-odd">directory = for name of the directory to check</dt>
<dd class="field-odd"><p><cite>(datatype = string)</cite>, e.g. ‘/dapsen/landing_zone/hmrc/self_assessment/2017/v1’</p>
</dd>
</dl>
</li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">EXAMPLE</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">spark_glob_all</span><span class="p">(</span><span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;hechlj&#39;</span><span class="p">,</span>
<span class="go">                directory = &#39;/dapsen/landing_zone/hmrc/self_assessment/2017/v1&#39;)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="adruk_tools.adr_functions.unzip_to_csv">
<span class="sig-prename descclassname"><span class="pre">adruk_tools.adr_functions.</span></span><span class="sig-name descname"><span class="pre">unzip_to_csv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">destination_path</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/adruk_tools/adr_functions.html#unzip_to_csv"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#adruk_tools.adr_functions.unzip_to_csv" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">WHAT IT IS</dt>
<dd class="field-odd"><p>PYSPARK FUNCTION</p>
</dd>
<dt class="field-even">WHAT IT DOES</dt>
<dd class="field-even"><p></p></dd>
</dl>
<ul class="simple">
<li><p>unzips a .csv.gz file into cdsw from a chosen location</p></li>
<li><p>puts the resulting unzipped csv into a user defined destination folder,</p></li>
<li><p>then deletes the original file from CDSW.</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">OUTPUT</dt>
<dd class="field-odd"><p>csv file</p>
</dd>
<dt class="field-even">NOTES</dt>
<dd class="field-even"><p></p></dd>
</dl>
<ul class="simple">
<li><p>will only work on zipped files which are less than 10GB</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">TESTED TO RUN ON</dt>
<dd class="field-odd"><p>zipped csv dataframe</p>
</dd>
<dt class="field-even">AUTHOR</dt>
<dd class="field-even"><p>Sophie-Louise Courtney</p>
</dd>
<dt class="field-odd">DATE</dt>
<dd class="field-odd"><p>18/01/2021</p>
</dd>
<dt class="field-even">VERSION</dt>
<dd class="field-even"><p>0.0.1</p>
</dd>
<dt class="field-odd">PARAMETERS</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<ul class="simple">
<li><dl class="simple">
<dt>file_path = path to file</dt><dd><p><cite>(datatype = 1 string)</cite>, e.g. ‘/dapsen/landing_zone’</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>file_name = full name of the file </dt><dd><p><cite>(datatype = 1 zipped dataframe)</cite>, e.g. ‘test_results.csv.gz’</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>destination_path = path to folder where the unzipped file will be stored</dt><dd><p><cite>(datatype = 1 string)</cite>, e.g. ‘/dapsen/workspace_zone’</p>
</dd>
</dl>
</li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">EXAMPLE</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">unzip_to_csv</span><span class="p">(</span><span class="n">file_path</span> <span class="o">=</span> <span class="n">adr_directory</span><span class="p">,</span>
<span class="go">                    file_name = file,</span>
<span class="go">                    destination_path = out)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="adruk_tools.adr_functions.update_file">
<span class="sig-prename descclassname"><span class="pre">adruk_tools.adr_functions.</span></span><span class="sig-name descname"><span class="pre">update_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cluster</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">template</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">join_variable</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/adruk_tools/adr_functions.html#update_file"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#adruk_tools.adr_functions.update_file" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">WHAT IT IS</dt>
<dd class="field-odd"><p>pyspark function</p>
</dd>
<dt class="field-even">WHAT IT DOES</dt>
<dd class="field-even"><p></p></dd>
</dl>
<ul class="simple">
<li><p>tries to update a file, if it exists, with information from a template. Else it writes out the template in its place.</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">RETURNS</dt>
<dd class="field-odd"><p>updated input file, or template</p>
</dd>
<dt class="field-even">OUTPUT TYPE</dt>
<dd class="field-even"><p>.csv file on HDFS, on 1 partition</p>
</dd>
<dt class="field-odd">AUTHOR</dt>
<dd class="field-odd"><p>hard-coded by David Cobbledick, function by Johannes Hechler</p>
</dd>
<dt class="field-even">DATE</dt>
<dd class="field-even"><p>15/10/2021</p>
</dd>
<dt class="field-odd">VERSION</dt>
<dd class="field-odd"><p>0.1</p>
</dd>
<dt class="field-even">CAVEATS</dt>
<dd class="field-even"><p></p></dd>
</dl>
<ul class="simple">
<li><p>file_path: there must be no directory named like file_path + ‘_temp’</p></li>
<li><p>file_path: only accepts csv</p></li>
<li><p>assumes files have headers</p></li>
<li><p>assumes both datasets have the join variable under the same name</p></li>
<li><p>assumes template is already in memory</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">PARAMETERS</dt>
<dd class="field-odd"><dl class="field-list simple">
<dt class="field-odd">cluster = name of the spark cluster to use</dt>
<dd class="field-odd"><p><cite>(datatype = session name, unquoted)</cite>, e.g. spark</p>
</dd>
<dt class="field-even">file_path = full path to the file that you want to update</dt>
<dd class="field-even"><p><cite>(datatype = string, without extension)</cite>, e.g. ‘/dapsen/workspace_zone/my_project/file’</p>
</dd>
<dt class="field-odd">template = name of the spark dataframe that you want to update from</dt>
<dd class="field-odd"><p><cite>(datatype = dataframe name, unquoted)</cite>, e.g. template_df</p>
</dd>
<dt class="field-even">join_variable = name(s) of the variable to join input file and template on</dt>
<dd class="field-even"><p><cite>(datatype = list of string)</cite>, e.g. [‘nino’]</p>
</dd>
</dl>
</dd>
<dt class="field-odd">EXAMPLE</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">update_file</span><span class="p">(</span> <span class="n">cluster</span> <span class="o">=</span> <span class="n">spark</span><span class="p">,</span>
<span class="go">                  file_path = &#39;/dap/project/02_specified_metadata/old_data&#39;,</span>
<span class="go">                  template = good_order,</span>
<span class="go">                  join_variable = [&#39;nhs_number&#39;]</span>
<span class="go">                  )</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="adruk_tools.adr_functions.update_file_later">
<span class="sig-prename descclassname"><span class="pre">adruk_tools.adr_functions.</span></span><span class="sig-name descname"><span class="pre">update_file_later</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cluster</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">template</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">join_variable</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">drop_from_template</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keep_before_join</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keep_after_join</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/adruk_tools/adr_functions.html#update_file_later"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#adruk_tools.adr_functions.update_file_later" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">WHAT IT IS</dt>
<dd class="field-odd"><p>pyspark function</p>
</dd>
<dt class="field-even">WHAT IT DOES</dt>
<dd class="field-even"><p></p></dd>
</dl>
<ul class="simple">
<li><p>tries to update a file, if it exists, with information from a template. Else it writes out the template in its place.</p></li>
<li><p>difference from update_file: used later in ASHE pipeline, slightly difference logic; too much hassle to combine the functions</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">RETURNS</dt>
<dd class="field-odd"><p>updated input file, or template</p>
</dd>
<dt class="field-even">OUTPUT TYPE</dt>
<dd class="field-even"><p>.csv file on HDFS, on 1 partition</p>
</dd>
<dt class="field-odd">AUTHOR</dt>
<dd class="field-odd"><p>hard-coded by David Cobbledick, function by Johannes Hechler</p>
</dd>
<dt class="field-even">DATE</dt>
<dd class="field-even"><p>15/10/2021</p>
</dd>
<dt class="field-odd">VERSION</dt>
<dd class="field-odd"><p>0.1</p>
</dd>
<dt class="field-even">CAVEATS</dt>
<dd class="field-even"><p></p></dd>
</dl>
<ul class="simple">
<li><p>file_path: there must be no directory named like file_path + ‘_temp’</p></li>
<li><p>file_path: only accepts csv</p></li>
<li><p>assumes files have headers</p></li>
<li><p>assumes both datasets have the join variable under the same name</p></li>
<li><p>assumes template is already in memory</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">PARAMETERS</dt>
<dd class="field-odd"><dl class="field-list simple">
<dt class="field-odd">cluster = name of the spark cluster to use</dt>
<dd class="field-odd"><p><cite>(datatype = session name, unquoted)</cite>, e.g. spark</p>
</dd>
<dt class="field-even">file_path = full path to the file that you want to update</dt>
<dd class="field-even"><p><cite>(datatype = string, without extension)</cite>, e.g. ‘/dapsen/workspace_zone/my_project/file’</p>
</dd>
<dt class="field-odd">template = name of the spark dataframe that you want to update from</dt>
<dd class="field-odd"><p><cite>(datatype = dataframe name, unquoted)</cite>, e.g. template_df</p>
</dd>
<dt class="field-even">join_variable = name(s) of the variable to join input file and template on</dt>
<dd class="field-even"><p><cite>(datatype = list of string)</cite>, e.g. [‘nino’]</p>
</dd>
<dt class="field-odd">drop_from_template = name(s) of the variable to join input file and template on</dt>
<dd class="field-odd"><p><cite>(datatype = list of string)</cite>, e.g. [‘nino’]</p>
</dd>
<dt class="field-even">keep_before_join = name(s) of the variable to join input file and template on</dt>
<dd class="field-even"><p><cite>(datatype = list of string)</cite>, e.g. [‘nino’]</p>
</dd>
<dt class="field-odd">keep_after_join = name(s) of the variable to join input file and template on</dt>
<dd class="field-odd"><p><cite>(datatype = list of string)</cite>, e.g. [‘nino’]</p>
</dd>
</dl>
</dd>
<dt class="field-even">EXAMPLE</dt>
<dd class="field-even"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">update_file</span><span class="p">(</span> <span class="n">cluster</span> <span class="o">=</span> <span class="n">spark</span><span class="p">,</span>
<span class="go">                  file_path = &#39;/dap/project/02_specified_metadata/old_data&#39;,</span>
<span class="go">                  template = good_order,</span>
<span class="go">                  join_variable = [&#39;nhs_number&#39;]</span>
<span class="go">                  )</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="adruk-tools">
<h1>adruk_tools<a class="headerlink" href="#adruk-tools" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="adruk_tools.html">adruk_tools package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="adruk_tools.html#subpackages">Subpackages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="adruk_tools.functions.html">adruk_tools.functions package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="adruk_tools.functions.html#module-adruk_tools.functions">Module contents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="adruk_tools.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="adruk_tools.html#module-adruk_tools.adr_functions">adruk_tools.adr_functions module</a></li>
<li class="toctree-l2"><a class="reference internal" href="adruk_tools.html#module-adruk_tools.cleaning">adruk_tools.cleaning module</a></li>
<li class="toctree-l2"><a class="reference internal" href="adruk_tools.html#module-adruk_tools.diagnostics">adruk_tools.diagnostics module</a></li>
<li class="toctree-l2"><a class="reference internal" href="adruk_tools.html#module-adruk_tools.dummy">adruk_tools.dummy module</a></li>
<li class="toctree-l2"><a class="reference internal" href="adruk_tools.html#module-adruk_tools">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="conf.html">conf module</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">setup module</a></li>
</ul>
</div>
</section>
<section id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        <a class="uplink" href="#">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="adruk_tools.html">adruk_tools package</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, Johannes Hechler.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.1.2.
    </div>
  </body>
</html>